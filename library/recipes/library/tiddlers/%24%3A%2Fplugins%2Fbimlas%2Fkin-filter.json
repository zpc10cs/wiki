{"title":"$:/plugins/bimlas/kin-filter","description":"Kin filter: Recursively looking for kinship between tiddler titles","author":"bimlas","version":"1.0.0","core-version":">=5.1.18","source":"https://gitlab.com/bimlas/tw5-kin-filter","plugin-type":"plugin","list":"README/syntax README/examples","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/bimlas/kin-filter/README/concept.svg\":{\"title\":\"$:/plugins/bimlas/kin-filter/README/concept.svg\",\"text\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" color-interpolation=\\\"auto\\\" height=\\\"492\\\" width=\\\"576\\\" stroke-linecap=\\\"square\\\" stroke=\\\"#000000\\\" font-family=\\\"Dialog\\\" font-size=\\\"12\\\" stroke-miterlimit=\\\"10\\\"><style><![CDATA[.C{stroke:none}.E{stroke-miterlimit:1.45000005}.F{fill:none}.I{stroke-linecap:butt}.G{fill:#f1c122}.L{font-size:26.667px}.M{fill:#4f4f4f}.D{fill:#d84100}.H{fill:#006eff}]]></style><defs><clipPath id=\\\"A\\\"><path d=\\\"M-15-15h630v745H-15z\\\"/></clipPath></defs><g clip-path=\\\"url(#A)\\\" shape-rendering=\\\"geometricPrecision\\\" text-rendering=\\\"geometricPrecision\\\"><rect class=\\\"C D\\\" x=\\\"15.917\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"161.955\\\"/><rect class=\\\"E F\\\" x=\\\"15.917\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"161.955\\\"/><rect class=\\\"C D\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"191.955\\\" x=\\\"95.917\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"191.955\\\" x=\\\"95.917\\\"/><rect class=\\\"C D\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"191.526\\\" x=\\\"204.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"191.526\\\" x=\\\"204.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"371.526\\\" x=\\\"284.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"371.526\\\" x=\\\"284.242\\\"/><rect class=\\\"C\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"251.526\\\" x=\\\"284.242\\\" fill=\\\"#008b00\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"251.526\\\" x=\\\"284.242\\\"/><rect class=\\\"C H\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"281.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"281.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"131.955\\\" x=\\\"95.917\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"131.955\\\" x=\\\"95.917\\\"/><rect class=\\\"C H\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"221.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"221.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C H\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"221.526\\\" x=\\\"504.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"221.526\\\" x=\\\"504.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"101.526\\\" x=\\\"284.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"101.526\\\" x=\\\"284.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"131.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"131.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"60\\\" y=\\\"71.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"60\\\" y=\\\"71.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"11.526\\\" x=\\\"284.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"11.526\\\" x=\\\"284.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"401.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"401.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"161.526\\\" x=\\\"504.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"161.526\\\" x=\\\"504.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"101.526\\\" x=\\\"504.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"40\\\" y=\\\"101.526\\\" x=\\\"504.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"341.526\\\" x=\\\"384.242\\\"/><rect class=\\\"E F\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"80\\\" y=\\\"341.526\\\" x=\\\"384.242\\\"/><rect class=\\\"C G\\\" height=\\\"40\\\" rx=\\\"4\\\" width=\\\"60\\\" y=\\\"11.526\\\" x=\\\"384.242\\\"/><g class=\\\"E F\\\"><rect height=\\\"40\\\" rx=\\\"4\\\" width=\\\"60\\\" y=\\\"11.526\\\" x=\\\"384.242\\\"/><g class=\\\"I\\\"><path d=\\\"M64.54 181.955h12.03v30h19.35\\\"/></g></g><path class=\\\"C\\\" d=\\\"M55.887 181.955l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M183.636 211.526h20.33\\\" stroke-width=\\\".731\\\"/><path class=\\\"C\\\" d=\\\"M175.897 211.525l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M252.69 211.526h12.03v180h19.984\\\"/><path class=\\\"C\\\" d=\\\"M244.212 211.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M252.69 211.526h12.03v60h19.984\\\"/><path class=\\\"C\\\" d=\\\"M324.25 271.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M332.703 271.526h32.018v30h20\\\"/><path d=\\\"M324.25 391.66l12-5-3 5 3 5z\\\" class=\\\"C\\\"/><path class=\\\"E F I\\\" d=\\\"M64.887 181.955H76.57v-30h19.4m236.723 119.57h32.018v-30h19.984m48.025.001h72.02\\\"/><path class=\\\"C\\\" d=\\\"M423.72 241.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M252.69 211.526h12.03v-90h19.984\\\"/><path class=\\\"C\\\" d=\\\"M323.728 121.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M332.703 121.526h32.018v30h19.984\\\"/><path class=\\\"E F I\\\" d=\\\"M332.703 121.526h32.018v-30h20m-132.03 120h12.03v-180h19.984\\\"/><path class=\\\"C\\\" d=\\\"M323.728 31.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M332.703 391.526h32.018v30h19.984m48.02-270h51.996v30h19.984\\\"/><path class=\\\"E F I\\\" d=\\\"M432.725 151.526h51.996v-30h19.984\\\"/><path class=\\\"C\\\" d=\\\"M423.725 151.526l12-5-3 5 3 5z\\\"/><path class=\\\"E F I\\\" d=\\\"M332.703 391.526h32.018v-30h20m-51.993-330h51.98\\\"/></g><g class=\\\"C\\\" letter-spacing=\\\"0\\\" word-spacing=\\\"0\\\" font-family=\\\"sans-serif\\\"><text class=\\\"L\\\" y=\\\"481.371\\\" x=\\\"259.32\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"M\\\" y=\\\"481.371\\\" x=\\\"259.32\\\">DEPTH</tspan></text><g font-size=\\\"40\\\"><text y=\\\"481.371\\\" x=\\\"395.524\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"L M\\\" y=\\\"481.371\\\" x=\\\"395.524\\\">1</tspan></text><text y=\\\"481.547\\\" x=\\\"516.117\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"L M\\\" y=\\\"481.547\\\" x=\\\"516.117\\\">2</tspan></text><text xml:space=\\\"preserve\\\" x=\\\"215.524\\\" y=\\\"481.371\\\"><tspan class=\\\"L M\\\" x=\\\"215.524\\\" y=\\\"481.371\\\">1</tspan></text><text xml:space=\\\"preserve\\\" x=\\\"107.792\\\" y=\\\"481.547\\\"><tspan class=\\\"L M\\\" x=\\\"107.792\\\" y=\\\"481.547\\\">2</tspan></text><text y=\\\"481.358\\\" x=\\\"27.486\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"L M\\\" y=\\\"481.358\\\" x=\\\"27.486\\\">3</tspan></text><text y=\\\"325.27\\\" x=\\\"268.643\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"L\\\" y=\\\"325.27\\\" x=\\\"268.643\\\" fill=\\\"#008b00\\\">BASE</tspan></text><text xml:space=\\\"preserve\\\" x=\\\"506.384\\\" y=\\\"325.27\\\"><tspan class=\\\"L H\\\" x=\\\"506.384\\\" y=\\\"325.27\\\">TO</tspan></text><text y=\\\"325.27\\\" x=\\\"96.958\\\" xml:space=\\\"preserve\\\"><tspan class=\\\"L D\\\" y=\\\"325.27\\\" x=\\\"96.958\\\">FROM</tspan></text></g></g></svg>\",\"type\":\"image/svg+xml\",\"tags\":\"picture\"},\"A\":{\"title\":\"A\",\"tags\":\"kin-example-top\"},\"B\":{\"title\":\"B\",\"tags\":\"A\"},\"C\":{\"title\":\"C\",\"tags\":\"B\",\"list\":\"D\"},\"D\":{\"title\":\"D\",\"tags\":\"C\",\"list\":\"E\"},\"E\":{\"title\":\"E\",\"tags\":\"C\",\"list\":\"G\"},\"F\":{\"title\":\"F\",\"tags\":\"B\"},\"G\":{\"title\":\"G\",\"tags\":\"F\"},\"H\":{\"title\":\"H\",\"tags\":\"F\"},\"$:/plugins/bimlas/kin-filter/README/examples\":{\"title\":\"$:/plugins/bimlas/kin-filter/README/examples\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define item-class(highlightfilter) <$list filter=\\\"[[kin-example-top]kin::to[]subfilter<__highlightfilter__>is[current]first[]]\\\">highlighted-toc-item</$list>\\n\\n\\\\define kin-example-with-toc(n,eg,ie)\\r\\n  <div class=\\\"doc-example\\\">\\r\\n    `$eg$`\\r\\n    <dd>&rarr; $ie$</dd>\\r\\n    <$list filter=\\\"[title<.state-prefix>addsuffix{!!title}addsuffix[/]addsuffix[$n$]]\\\" variable=\\\".state\\\">\\r\\n      <$reveal state=<<.state>> type=\\\"nomatch\\\" text=\\\"show\\\">\\r\\n        <dl>\\r\\n          <dd><$button set=<<.state>> setTo=\\\"show\\\">Try it</$button></dd>\\r\\n        </dl>\\r\\n      </$reveal>\\r\\n      <$reveal state=<<.state>> type=\\\"match\\\" text=\\\"show\\\">\\r\\n        <dl>\\r\\n          <dd><$button set=<<.state>> setTo=\\\"\\\">Hide</$button></dd>\\r\\n        </dl>\\r\\n        <blockquote class=\\\"doc-example-result\\\">\\r\\n          <ul><$list filter=\\\"[[kin-example-top]kin::to[]subfilter<__eg__>sort[]]\\\" emptyMessage=\\\"(empty)\\\">\\r\\n            <li><$link><$view field=\\\"title\\\"/></$link></li>\\r\\n          </$list></ul>\\r\\n          Results highlighted in the tree:\\n\\n          <<kin-toc \\\"$eg$\\\">>\\r\\n        </blockquote>\\r\\n      </$reveal>\\r\\n    </$list>\\r\\n  </div>\\r\\n\\\\end\\n\\n\\\\define each-level(highlightfilter)\\r\\n  <li>\\r\\n    <$wikify name=\\\"transcluded-item-class\\\" text=\\\"\\\"\\\"<$macrocall $name=\\\"item-class\\\" highlightfilter=<<__highlightfilter__>>/>\\\"\\\"\\\">\\r\\n      <$link class=<<transcluded-item-class>> ><<currentTiddler>></$link>\\r\\n    </$wikify>\\r\\n    <ul>\\r\\n      <$list filter=\\\"[[kin-example-top]kin::to[]tag<currentTiddler>]\\\">\\r\\n        <$macrocall $name=\\\"each-level\\\" highlightfilter=<<__highlightfilter__>>/>\\r\\n      </$list>\\r\\n    </ul>\\r\\n  </li>\\r\\n\\\\end\\n\\n\\\\define kin-toc(highlightfilter)\\r\\n  <$tiddler tiddler=\\\"kin-example-top\\\">\\r\\n    <ul>\\r\\n      <$macrocall $name=\\\"each-level\\\" highlightfilter=<<__highlightfilter__>>/>\\r\\n    </ul>\\r\\n  </$tiddler>\\r\\n\\\\end\\n\\n<style>\\r\\n  .highlighted-toc-item {\\r\\n    color: red !important;\\r\\n  }\\r\\n</style>\\n\\nExample tree (to really understand, look at the tiddlers):\\n\\n<<kin-toc \\\"!is[current]\\\">>\\n\\n''The tree'' below the examples only helps in understanding the filter, it ''is not part of the output''.\\n\\n''Feel free to edit [[this tiddler|$:/plugins/bimlas/kin-filter/README/examples]] to test your own filter expressions as well!'' If you want to undo the changes you made, just delete the tiddler, it will restore itself to its initial state.\\n\\n<<kin-example-with-toc 1 \\\"[kin[C]]\\\" \\\"input titles which are family members of the parameter title\\\">>\\r\\n<<kin-example-with-toc 2 \\\"[kin[C]kin[F]]\\\" \\\"common family members of each of the specified titles (intersection)\\\">>\\r\\n<<kin-example-with-toc 3 \\\"[kin[C]!kin[F]]\\\" \\\"difference of families of the specified titles (complement)\\\">>\\r\\n<<kin-example-with-toc 4 \\\"[[C]] [[F]] +[kin[]]\\\" \\\"collected titles which are family members of any of the input tiddlers (union)\\\">>\\r\\n<<kin-example-with-toc 5 \\\"[kin::to[B]]\\\" \\\"successors of the given tiddler\\\">>\\r\\n<<kin-example-with-toc 6 \\\"[kin::from[E]kin::to[B]]\\\" \\\"subset of the family tree\\\">>\\r\\n<<kin-example-with-toc 7 \\\"[kin::from:2[E]]\\\" \\\"ancestors of the given tiddler until the given depth\\\">>\\r\\n<<kin-example-with-toc 8 \\\"[kin:tags:from[G]]\\\" \\\"ancestors of tiddler based on `tags` field (`tags` points to parents)\\\">>\\r\\n<<kin-example-with-toc 9 \\\"[kin:list:to[G]]\\\" \\\"ancestors of tiddler based on `list` field (`list` point to children)\\\">>\\r\\n\"},\"$:/plugins/bimlas/kin-filter/README/syntax\":{\"title\":\"$:/plugins/bimlas/kin-filter/README/syntax\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"! Kin filter operator\\n\\n* https://gitlab.com/bimlas/tw5-kin-filter (official repository)\\r\\n* https://github.com/bimlas/tw5-kin-filter (mirror, please star if you like it)\\n\\nThe purpose of the ''kin'' operator with examples:\\n\\n* Finds related tags, related tiddlers in any depth\\r\\n* Finds out where base tiddler originates and what other elements originate from it\\r\\n* Finds the ancestors and successors of a family member\\r\\n* Finds the \\\"leaves\\\" of the branch of the base tiddler in a tree-like structure (where the base tiddler is a leaf)\\r\\n* Finds the super- and subsets / groups of a mathematical set (where the base tiddler is a set)\\n\\n[img[$:/plugins/bimlas/kin-filter/README/concept.svg]]\\n\\n|''input''|a [[selection of titles|https://tiddlywiki.com/#Title%20Selection]]|\\r\\n|''suffix''|the ''kin'' operator uses a rich suffix, see below for details|\\r\\n|''parameter''|''B'' base tiddler title or nothing|\\r\\n|''output''|''with parameter B''<br>&raquo; those input titles which are ''kin with B'' <br>''without B''<br>&raquo; ''all'' tiddler titles which are ''kin with input titles'' (treat input titles as base tiddlers)|\\r\\n|''`!` output''|''with parameter B''<br>&raquo; those input titles which are ''//NOT// kin with B''<br>''without parameter B''<br>&raquo; ignored|\\n\\nThe ''kin'' operator uses an extended syntax that permits multiple fields and flags to be passed:\\n\\n```\\r\\n[kin:<field>:<direction>:<depth>[<operand>]]\\r\\n```\\n\\n* ''field'': name of the [[field|https://tiddlywiki.com/#TiddlerFields]] which connecting tiddlers (assumed to be a [[title list|https://tiddlywiki.com/#Title%20List]], defaulting to `tags`)\\r\\n* ''direction'':  collect the tiddler titles in this direction relative to the base tiddler\\r\\n** ''from'': collect kins of base tiddler pointing from it (including the base tiddler title itself)\\r\\n** ''to'': collect kins of base tiddler pointing to it (including the base tiddler title itself)\\r\\n** ''with'': (the default) union of the aboves\\r\\n* ''depth'': maximum depth of the collected labels in the tree structure relative to the base tiddler (a positive number, not limited by default)\\r\\n* ''operand'': filter operand, the base tiddler\\n\\n''kin'' is a [[modifier|https://tiddlywiki.com/#Selection%20Constructors]], but without ''B'' parameter is a [[constructor|https://tiddlywiki.com/#Selection%20Constructors]].\\n\\n!! Installation instructions\\n\\nTo add the plugin to your own ~TiddlyWiki5, just drag this link to the browser window:\\n\\n$:/plugins/bimlas/kin-filter\\n\\nFor other installation options see the repositories above.\\n\\n//Select the next tab to continue.//\\r\\n\"},\"$:/plugins/bimlas/kin-filter/kin.js\":{\"title\":\"$:/plugins/bimlas/kin-filter/kin.js\",\"text\":\"/*\\\\\\r\\ntitle: $:/plugins/bimlas/kin-filter/kin.js\\r\\ntype: application/javascript\\r\\nmodule-type: filteroperator\\r\\n\\r\\nFinds out where a tiddler originates from and what other tiddlers originate from it\\r\\n\\r\\n\\\\*/\\r\\n(function() {\\r\\n\\r\\n\\t/*jslint node: true, browser: true */\\r\\n\\t/*global $tw: true */\\r\\n\\t\\\"use strict\\\";\\r\\n\\r\\n\\tfunction collectTitlesRecursively(baseTiddler,baseTitle,options) {\\r\\n\\t\\tvar cacheName = \\\"kin-filter-\\\" + baseTitle + \\\"-\\\" + options.fieldName + \\\"-\\\",\\r\\n\\t\\t\\ttitlesPointingFromBase = {},\\r\\n\\t\\t\\ttitlesPointingToBase = {},\\r\\n\\t\\t\\tresultsFrom = [],\\r\\n\\t\\t\\tresultsTo = [];\\r\\n\\r\\n\\t\\t/* Copy of findListingsOfTiddler, but it's searching in shadows as well. */\\r\\n\\t\\tfunction findListingsOfTiddler(targetTitle,fieldName) {\\r\\n\\t\\t\\tfieldName = fieldName || \\\"list\\\";\\r\\n\\t\\t\\tvar titles = [];\\r\\n\\t\\t\\toptions.wiki.eachTiddlerPlusShadows(function(tiddler,title) {\\r\\n\\t\\t\\t\\tvar list = $tw.utils.parseStringArray(tiddler.fields[fieldName]);\\r\\n\\t\\t\\t\\tif(list && list.indexOf(targetTitle) !== -1) {\\r\\n\\t\\t\\t\\t\\ttitles.push(title);\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t});\\r\\n\\t\\t\\treturn titles;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tfunction addToResultsIfNotFoundAlready(alreadyFound,title,depth) {\\r\\n\\t\\t\\tif(title in alreadyFound) {\\r\\n\\t\\t\\t\\treturn false;\\r\\n\\t\\t\\t}\\r\\n\\t\\t\\talreadyFound[title] = depth;\\r\\n\\t\\t\\treturn true\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tfunction collectTitlesPointingFrom(tiddler,title,currentDepth) {\\r\\n\\t\\t\\tif(addToResultsIfNotFoundAlready(titlesPointingFromBase,title,currentDepth)) {\\r\\n\\t\\t\\t\\tcurrentDepth += 1;\\r\\n\\t\\t\\t\\tif(tiddler) {\\r\\n\\t\\t\\t\\t\\t$tw.utils.each(tiddler.getFieldList(options.fieldName),function(targetTitle) {\\r\\n\\t\\t\\t\\t\\t\\tcollectTitlesPointingFrom(options.wiki.getTiddler(targetTitle),targetTitle,currentDepth);\\r\\n\\t\\t\\t\\t\\t});\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t}\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tfunction collectTitlesPointingTo(title,currentDepth) {\\r\\n\\t\\t\\tif(addToResultsIfNotFoundAlready(titlesPointingToBase,title,currentDepth)) {\\r\\n\\t\\t\\t\\tcurrentDepth += 1;\\r\\n\\t\\t\\t\\t$tw.utils.each(findListingsOfTiddler(title,options.fieldName),function(targetTitle) {\\r\\n\\t\\t\\t\\t\\tcollectTitlesPointingTo(targetTitle,currentDepth);\\r\\n\\t\\t\\t\\t});\\r\\n\\t\\t\\t}\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tfunction getObjectKeysByExpression(object,callback) {\\r\\n\\t\\t\\tvar key,\\r\\n\\t\\t\\t\\tresults = [];\\r\\n\\t\\t\\tfor (key in object) {\\r\\n\\t\\t\\t\\tif (object.hasOwnProperty(key) && callback(object[key])) {\\r\\n\\t\\t\\t\\t\\tresults.push(key);\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t}\\r\\n\\t\\t\\treturn results;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tfunction getResultsInGivenDepth(cachedData) {\\r\\n\\t\\t\\tif(options.depth) {\\r\\n\\t\\t\\t\\treturn getObjectKeysByExpression(cachedData,function(value) {\\r\\n\\t\\t\\t\\t\\treturn value <= options.depth;\\r\\n\\t\\t\\t\\t})\\r\\n\\t\\t\\t} else {\\r\\n\\t\\t\\t\\treturn Object.keys(cachedData);\\r\\n\\t\\t\\t}\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif((options.direction === \\\"from\\\") || (options.direction === \\\"with\\\")) {\\r\\n\\t\\t\\tresultsFrom = $tw.wiki.getGlobalCache(cacheName + \\\"from\\\",function() {\\r\\n\\t\\t\\t\\tcollectTitlesPointingFrom(baseTiddler,baseTitle,0);\\r\\n\\t\\t\\t\\treturn titlesPointingFromBase;\\r\\n\\t\\t\\t});\\r\\n\\t\\t\\tresultsFrom = getResultsInGivenDepth(resultsFrom);\\r\\n\\t\\t}\\r\\n\\t\\tif((options.direction === \\\"to\\\") || (options.direction === \\\"with\\\")) {\\r\\n\\t\\t\\tresultsTo = $tw.wiki.getGlobalCache(cacheName + \\\"to\\\",function() {\\r\\n\\t\\t\\t\\tcollectTitlesPointingTo(baseTitle,0);\\r\\n\\t\\t\\t\\treturn titlesPointingToBase;\\r\\n\\t\\t\\t});\\r\\n\\t\\t\\tresultsTo = getResultsInGivenDepth(resultsTo);\\r\\n\\t\\t}\\r\\n\\t\\treturn $tw.utils.pushTop(resultsFrom,resultsTo);\\r\\n\\t}\\r\\n\\r\\n\\t/*\\r\\n\\tExport our filter function\\r\\n\\t*/\\r\\n\\texports.kin = function(source,operator,options) {\\r\\n\\t\\tvar results = [],\\r\\n\\t\\t\\tneedsExclusion = operator.prefix === \\\"!\\\",\\r\\n\\t\\t\\tsuffixes = operator.suffixes || [],\\r\\n\\t\\t\\tfilterOptions = {\\r\\n\\t\\t\\t\\twiki: options.wiki,\\r\\n\\t\\t\\t\\tfieldName: ((suffixes[0] || [])[0] || \\\"tags\\\").toLowerCase(),\\r\\n\\t\\t\\t\\tdirection: ((suffixes[1] || [])[0] || \\\"with\\\").toLowerCase(),\\r\\n\\t\\t\\t\\tdepth: Number((suffixes[2] || [])[0]),\\r\\n\\t\\t\\t};\\r\\n\\r\\n\\t\\tif((operator.operand === \\\"\\\") && (needsExclusion)) {\\r\\n\\t\\t\\treturn [];\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif(operator.operand !== \\\"\\\") {\\r\\n\\t\\t\\tvar baseTitle = operator.operand,\\r\\n\\t\\t\\t\\tbaseTiddler = options.wiki.getTiddler(baseTitle),\\r\\n\\t\\t\\t\\tfoundTitles = collectTitlesRecursively(baseTiddler,baseTitle,filterOptions);\\r\\n\\r\\n\\t\\t\\tsource(function(tiddler,title) {\\r\\n\\t\\t\\t\\tif(needsExclusion === (foundTitles.indexOf(title) === -1)) {\\r\\n\\t\\t\\t\\t\\tresults.push(title);\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t});\\r\\n\\t\\t} else {\\r\\n\\t\\t\\tsource(function(tiddler,title) {\\r\\n\\t\\t\\t\\tresults = $tw.utils.pushTop(results,collectTitlesRecursively(tiddler,title,filterOptions));\\r\\n\\t\\t\\t});\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\treturn results;\\r\\n\\t}\\r\\n})();\\r\\n\",\"type\":\"application/javascript\",\"module-type\":\"filteroperator\"}}}"}