{"title":"$:/plugins/dullroar/sitemap","description":"TiddlyWiki5 plugin to generate sitemap.xml.","author":"Jim Lehmer","version":"0.0.2","core-version":">=5.0.8","source":"https://github.com/dullroar/TW5-sitemap","plugin-type":"plugin","dependents":"","type":"application/json","text":"{\"tiddlers\":{\"RenderSitemap\":{\"title\":\"RenderSitemap\",\"created\":\"20150104141300000\",\"creator\":\"Jim\",\"extension\":\".xml\",\"modified\":\"20150104141300000\",\"modifier\":\"Jim\",\"tags\":\"static $:/tags/Exporter\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define renderContent()\\r\\n<$text text=<<sitemapentries filter:\\\"\\\"\\\"$(exportFilter)$\\\"\\\"\\\">>/>\\r\\n\\\\end\\r\\n<<renderContent>>\"},\"sitemap\":{\"title\":\"sitemap\",\"created\":\"20150104144500000\",\"creator\":\"Jim\",\"modified\":\"20150104144500000\",\"modifier\":\"Jim\",\"tags\":\"static\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define tv-wikilink-template() #$uri_encoded$\\r\\n\\\\define tv-config-toolbar-icons() no\\r\\n\\\\define tv-config-toolbar-text() no\\r\\n\\\\define tv-config-toolbar-class() tc-btn-invisible\\r\\n`<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\r\\n<urlset xmlns=\\\"http://www.sitemaps.org/schemas/sitemap/0.9\\\">`<$set name=\\\"exportFilter\\\" value=\\\"[!is[system]!title[Table of Contents]!sort[modifed]]\\\">\\r\\n{{RenderSitemap}}</$set>`</urlset>`\"},\"sitemapentries.js\":{\"title\":\"sitemapentries.js\",\"created\":\"20150104141600000\",\"creator\":\"Jim\",\"modified\":\"20150124151600000\",\"modifier\":\"Jim\",\"module-type\":\"macro\",\"tags\":\"static\",\"type\":\"application/javascript\",\"text\":\"/*\\\\\\r\\nMacro to output tiddlers matching a filter to sitemap.xml entries.\\r\\nhttp://www.sitemaps.org/protocol.html\\r\\n\\\\*/\\r\\n(function () {\\r\\n  /*jslint node: true, browser: true */\\r\\n  /*global $tw: false */\\r\\n  'use strict';\\n\\n  exports.name = 'sitemapentries';\\n\\n  exports.params = [{ name: 'filter' }];\\n\\n  let XML = {};\\n\\n  XML.escapify = function (input) {\\r\\n    return input\\r\\n      .replace(/</gm, '&lt;')\\r\\n      .replace(/>/gm, '&gt;')\\r\\n      .replace(/&/gm, '&amp;')\\r\\n      .replace(/\\\"/gm, '&quot;')\\r\\n      .replace(/'/gm, '&apos;');\\r\\n  };\\n\\n  XML.twDateToWebDate = function (twDate) {\\r\\n    return $tw.utils.formatDateString(twDate, 'YYYY-0MM-0DD');\\r\\n  };\\n\\n  XML.stringify = function (data) {\\r\\n    let x = '';\\r\\n    data.forEach(function (element, index, array) {\\r\\n      x += '\\\\t<url>\\\\n';\\r\\n      const server = $tw.wiki.getTiddlerText('sitemapserver', '');\\r\\n      x += `\\\\t\\\\t<loc>${server}#:${element.title.replace(/ /g, '%2520')}</loc>\\\\n`;\\r\\n      if (element.modified) {\\r\\n        x += '\\\\t\\\\t<lastmod>' + XML.twDateToWebDate($tw.utils.parseDate(element.modified)) + '</lastmod>\\\\n';\\r\\n      }\\r\\n      x += '\\\\t\\\\t<changefreq>';\\r\\n      if (element.title.toLowerCase() === 'index' || element.title.toLowerCase() === 'home') {\\r\\n        x += 'weekly';\\r\\n      } else {\\r\\n        x += 'monthly';\\r\\n      }\\r\\n      x += '</changefreq>\\\\n';\\r\\n      x += '\\\\t\\\\t<priority>';\\r\\n      if (element.title.toLowerCase() === 'index' || element.title.toLowerCase() === 'home') {\\r\\n        x += '1.0';\\r\\n      } else if (element.color !== undefined) {\\r\\n        x += '0.8';\\r\\n      } else {\\r\\n        x += '0.5';\\r\\n      }\\r\\n      x += '</priority>\\\\n';\\r\\n      x += '\\\\t</url>\\\\n';\\r\\n    });\\r\\n    return x;\\r\\n  };\\n\\n  exports.run = function (filter) {\\r\\n    const tiddlers = this.wiki.filterTiddlers(filter);\\r\\n    const data = [];\\r\\n    for (let t = 0; t < tiddlers.length; t++) {\\r\\n      const tiddler = this.wiki.getTiddler(tiddlers[t]);\\r\\n      if (tiddler) {\\r\\n        const fields = {};\\r\\n        for (const field in tiddler.fields) {\\r\\n          fields[field] = XML.escapify(tiddler.getFieldString(field));\\r\\n        }\\r\\n        data.push(fields);\\r\\n      }\\r\\n    }\\r\\n    return XML.stringify(data);\\r\\n  };\\r\\n})();\\r\\n\"},\"sitemapserver\":{\"title\":\"sitemapserver\",\"created\":\"20150104145100000\",\"creator\":\"Jim\",\"modified\":\"20150104145100000\",\"modifier\":\"Jim\",\"tags\":\"static\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"https://onetwo.ren/wiki/\"}}}"}